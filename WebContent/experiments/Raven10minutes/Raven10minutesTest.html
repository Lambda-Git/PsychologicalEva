<!doctype html>
<html>
<head>
    <title>图形推理测验(练习)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link href="../../../css/mui.min.css" rel="stylesheet"/>
    <link href="../../../css/common.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../../css/icons-extra.css"/>

    <script src="../../js/wz_jsgraphics/wz_jsgraphics.js" type=text/javascript></script>
    <script src="../../js/Statistics/Statistics.js" type=text/javascript></script>
    <script src="../../js/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="../../js/jquery-ui-1.9.1.custom.min.js" type="text/javascript"></script>
    <script src="../../js/utils.js" type=text/javascript></script>
    <script src="../../js/progress_bar.js" type=text/javascript></script>

    <script src="../../../js/mui.min.js"></script>
    <script src="../../../js/common.js"></script>
    <script src="../../../js/jquery.min.js"></script>
    <style type="text/css">
        body {
            margin: 0px;
            background-color: #000000;
        }

        span {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 80pt;
            color: #ffffff;
        }

        span.loading {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 20pt;
            color: #ffffff;
        }

        span.fixation {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 80pt;
            color: #ffffff;
        }

        span.message {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 15pt;
            color: #ffffff;
        }

        span.addsubmildiv {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 80pt;
            color: #ffffff;
        }

        span.asmdresult {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 50pt;
            color: #ffffff;
        }

        .stroopnum_tip_div {
            margin: 0 auto;
            background-color: #000000;
            clear: both;
            align: center;
            height: 30%;
            width: 60%;
            position: absolute;
            left: 20%;
            top: 35%;
            text-align: center;
            font-family: Verdana, Arial, Helvetica, sans-serif;
            font-size: 40px;
            color: #FFFFFF;
        }

        .stroopnum_relax_tips_div {
            text-align: center;
            background-color: #000000;
            clear: both;
            height: 100px;
            position: absolute;
            left: 35%;
            right: 30%;
            top: 200px;
            font-family: Verdana, Arial, Helvetica, sans-serif;
            font-size: 27px;
            color: #FFFFFF;
        }

    </style>
</head>
<body oncontextmenu="return false;">
<div class="mui-row formalResult active">
    <div class="mui-col-sm-3"></div>
    <div class="mui-col-sm-6">
        <img class="practiceSmilelGif" src="../../images/smile1.gif" />
    </div>
    <div class="mui-col-sm-3"></div>
</div>

<form id="result" name="result" method="post" action="" style="display: none">
    <input type=hidden value="4293" name="taskid" id="taskid"/>
    <input type=hidden value="0" name="sumitcoids" id="sumitcoids"/>
    <input type=hidden value="0" name="targetpagename" id="targetpagename"/>
    <input type=hidden value="Raven10minutes" name="taskIdentifier" id="taskIdentifier"/>

</form>

<table height="50%" border=0px width="100%" border="0" style="margin-top: 40px">
    <tr>
        <td align="center" valign="middle">
            <table cellspacing="0" border=0px cellpadding="0" width="100%" align="center" border="0">
                <tr>
                    <td align=center height=100px colspan=4>
								<span id="up_span" class="addsubmildiv">
								<img name="up_image" id="up_image" src="../../images/black_toosmall.jpg"/>
								</span>
                        <span id="loading" class="loading">
									<img name="imageObj" id="imageObj" src="../../images/black_toosmall.jpg"/>
									<br/>
								</span>
                    </td>
                </tr>
                <tr>
                    <td align=center height=110px width="25%">
                        <input id="1" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">

                    </td>
                    <td align=center height=110px width="25%">
                        <input id="2" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">

                    </td>
                    <td align=center height=110px width="25%">
                        <input id="3" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">
                    </td>
                    <td align=center height=110px width="25%">
                        <input id="4" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">

                    </td>
                </tr>
                <tr>
                    <td align=center height=100px>
                        <input id="5" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">

                    </td>
                    <td align=center height=100px>
                        <input id="6" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">
                    </td>
                    <td align=center height=100px>
                        <input id="7" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">
                    </td>
                    <td align=center height=100px>
                        <input id="8" onclick="check_the_image(this.id);" name="imageField1" type="image"
                               src="../../images/black_toosmall.jpg">
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>


<div id="stroopnum_tip" style="display:none;" class="stroopnum_tip_div">
</div>
<div id="myCanvas" style="display:none;" class="stroopnum_relax_tips_div">
    <br/>
    <!-- <fmt:message key="jsp.eachtest.rest"/>-->
</div>

<div id="feed_back_div" style="display:none;" class="stroopnum_relax_tips_div">
    <span id="message" class="message"></span>
    <span><img name="messageimageObj" id="messageimageObj" src="../../images/black_toosmall.jpg"/></span>
</div>

</body>
<script type="text/javascript">

var pic_path = "../../testpics/revan/";
var black_image = "../../images/black_toosmall.jpg";
var pleased_image = "../../images/pleased.JPG";
var depressed_image = "../../images/depressed.JPG";
var loading_image = "../../images/ajax-loader(2).gif";

var pic_size = 5;

var image_0 = new Array();
var image_1 = new Array();
var image_2 = new Array();
var image_3 = new Array();
var image_4 = new Array();
var image_5 = new Array();
var image_6 = new Array();
var image_7 = new Array();
var image_8 = new Array();
var all_a = new Array(image_0, image_1, image_2, image_3, image_4, image_5, image_6, image_7, image_8);

var progress = 0;//loading images progress

//var correct_result=new Array("5","1","7","4","3","1","6","1","8","4","5","6","2","1","2","4","6","7","3","8","8","7","6","3","7","2","7","5","6","5","4","8","5","1","3","2");
var correct_result = new Array("6", "3", "6", "2", "1", "3", "4", "5", "1", "3", "5", "6", "4", "3", "4", "5", "7", "4", "5", "4", "7", "6", "1", "2", "8", "6", "5", "4", "1", "2", "5", "2", "1", "5", "1", "6", "3", "2", "4", "3", "5", "1", "7", "4", "3", "1", "6", "1", "8", "4", "5", "6", "2", "1", "2", "4", "6", "7", "3", "8", "8", "7", "6", "3", "7", "2", "7", "5", "6", "5", "4", "8", "5", "1", "3", "2");
var correct_result = new Array("4", "2", "8", "3", "7");


//var exe=new Array("8","4","5","1","2","5","6","3","7","8","7","6");
//var test=new Array("5","1","7","4","3","1","6","1","8","4","5","6","2","1","2","4","6","7","3","8","8","7","6","3","7","2","7","5","6","5","4","8","5","1","3","2");

var user_result = new Array();
var rc_key = new Array();
var rc_time = new Array();

var timer_id;
var index = 0;
var trial_interval = 300; // interval between trials in ms
var key_interval = 1000; // interval after key press in ms
var fixation_interval = 400; //
var blank_interval = 1000; //
var short_blank_interval = 500; //
var relax_interval = 2000;
var feedback_interval = 2000;// feedback time
var ifinite_wait_interval = 40000000;
var start_delay = 1000; // in ms
var undef_key = "undef";
var undef_time = trial_interval;
var timestamp;


var jg = new jsGraphics("myCanvas");
var midle_relax_interval = 1000;//
var progressbar = 0;//
var bar_length = 300;//
var update_interval = midle_relax_interval / bar_length;//
var current_index = 0;
var start_time = getTimestamp();
var ristrict_time = 4 * 60 * 1000;

var stimidAll = new Array();
var type4All = new Array();

function preloadimages() {

    for (var i = 1; i <= pic_size; i++) {
        //var image0=new Image();
        //image0.src=pic_path+i+"-"+0+".gif";
        //all_a[0].push(image0);
        for (var j = 0; j <= 8; j++) {
            var image = new Image();
            image.src = pic_path + "t" + i + "-" + j + ".gif";
            all_a[j].push(image);
        }
        progress = Math.round(100 * i / pic_size);
        setTimeout("show_load_image_progress(" + progress + ")", i * 50);//i*50
    }
    setTimeout("wait_to_start()", pic_size * 50);
}

function show_load_image_progress(progress) {
    document.getElementById("loading").innerHTML = "<img  src='../../images/ajax-loader(2).gif'/><br/><br/>loading images... " + progress + "%";
}

function wait_to_start() {
    if (progress >= 100) {
        document.getElementById('loading').style.display = "none";
        any_key_start();
    } else {
        setTimeout("wait_to_start()", 200);
    }
}

/* 按任意键继续 */
function any_key_start() {
    //current_start_time=getTimestamp();
    //current_index=0;
    document.getElementById("myCanvas").style.display = "none";
    var stroopnum_tips = document.getElementById("stroopnum_tip");
    stroopnum_tips.style.display = "block";
    stroopnum_tips.innerHTML = "<div class='mui-row' style='text-align: center'>" +
        "<button type='button' class='mui-btn mui-btn-primary startBtn' onclick='ignor_key_press()'>开始练习</button>" +
        "</div>";
    document.onkeydown = ignor_key_press;
}

function ifback()    //判断整个测试过程时间是否用完
{
    post_result();
}

function ignor_key_press() {
    current_start_time = getTimestamp();//record part start time
    var stroopnum_tips = document.getElementById("stroopnum_tip");
    stroopnum_tips.style.display = "none";
    setTimeout("ifback()", ristrict_time); //产生时间触发器ifback
    setTimeout("show_fixation()", blank_interval);
}

/* the beginning method, in actural it is show blank screen */
function show_fixation() {
    document.getElementById("feed_back_div").style.display = "none";
    if (index < pic_size)//simple and complex
    {
        var need_ralex = false;
        if ((getTimestamp() - start_time > ristrict_time))//relax
        {
            //alert("测验时间已到，数据将自动提交");
            post_result();


        } else {
            setTimeout("change_view()", 0);
        }

    } else {
        //alert("测验时间已到，数据将自动提交");
        post_result();
    }
}


function change_view() {

    document.getElementById("up_span").style.display = "block";
    document.getElementById("up_image").src = all_a[0][index].src;
    for (var i = 1; i <= 8; i++) {
        document.getElementById("" + i).style.display = "block";
        document.getElementById("" + i).src = all_a[i][index].src;
    }

    user_result[index] = undef_key;
    stimidAll[index] = index + 1;
    type4All[index] = 0;

    //document.onkeydown = key_down;
}

function add_result_to_form(id, value) {
    var elem = document.createElement("input");
    elem.setAttribute("type", "text");
    elem.setAttribute("id", id);
    elem.setAttribute("name", id);
    elem.setAttribute("value", value);

    document.getElementById("result").appendChild(elem);
}

function post_result() {
    add_result_to_form("correct_result", get_related_result(correct_result, user_result.length).join(";"));
    add_result_to_form("user_result", user_result.join(";"));
    add_result_to_form("duration", getTimestamp() - start_time);

    ///////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////
    var type4set = type4All.join(";");
    var stimidset = stimidAll.join(";");
    var correctanswerset = get_related_result(correct_result, user_result.length).join(";");
    var radioset = user_result.join(";");
    var timeaverage = getTimestamp() - start_time;
    add_result_to_form("type4set", type4set);
    add_result_to_form("stimidset", stimidset);
    add_result_to_form("correctanswerset", correctanswerset);
    add_result_to_form("radioset", radioset);
    add_result_to_form("timeaverage", timeaverage);
    var numset = "";
    var buttonset = "";
    var timeset = "";
    var radiolist1set = "";
    var radiolist2set = "";
    var radiolist3set = "";
    var radiolist4set = "";
    var radiolist5set = "";
    var radiolist6set = "";
    var radiolist7set = "";
    var radiolist8set = "";
    var radiolist9set = "";
    var radiolist10set = "";
    if (user_result.length > 1) {
        for (var i = 0; i < user_result.length - 1; i++) {
            numset = numset + ";" + "";
            buttonset = buttonset + ";" + "";
            timeset = timeset + ";" + "";
            radiolist1set = radiolist1set + ";" + "";
            radiolist2set = radiolist2set + ";" + "";
            radiolist3set = radiolist3set + ";" + "";
            radiolist4set = radiolist4set + ";" + "";
            radiolist5set = radiolist5set + ";" + "";
            radiolist6set = radiolist6set + ";" + "";
            radiolist7set = radiolist7set + ";" + "";
            radiolist8set = radiolist8set + ";" + "";
            radiolist9set = radiolist9set + ";" + "";
            radiolist10set = radiolist10set + ";" + "";
        }
    }
    var countOfCorrectNumber_ByType = getCorrectCountSortByType(numset, correctanswerset, type4set);
    var countOfCorrectButton_ByType = getCorrectCountSortByType(buttonset, correctanswerset, type4set);
    var countOfCorrectRadio_ByType = getCorrectCountSortByType(radioset, correctanswerset, type4set);
    var countOfCorrectButton_ByType_Corrected = getCorrectCountSortByType_Corrected(buttonset, correctanswerset, type4set);
    var percentageCorrectNumber_ByType = getPercentageCorreceSortByType(numset, correctanswerset, type4set);
    var percentageCorrectButton_ByType = getPercentageCorreceSortByType(buttonset, correctanswerset, type4set);
    var percentageCorrectRadio_ByType = getPercentageCorreceSortByType(radioset, correctanswerset, type4set);
    var meanNumber_ByType = getMeanSortByType(numset, type4set);
    var sumNumber_ByType = getSumSortByType(numset, type4set);
    var meanRT_ByType = getMeanSortByType(timeset, type4set);
    var meanDeviationNumber_ByType = getMeanDeviationSortByType(numset, correctanswerset, type4set);
    var sumWeightedRadio_ByType = getWeightedScoreSortByType(radioset, type4set, radiolist1set, radiolist2set, radiolist3set, radiolist4set, radiolist5set, radiolist6set, radiolist7set, radiolist8set, radiolist9set, radiolist10set);
    var type4_Unique = getType(type4set);
    add_result_to_form("countOfCorrectNumber_ByType", countOfCorrectNumber_ByType);
    add_result_to_form("countOfCorrectButton_ByType", countOfCorrectButton_ByType);
    add_result_to_form("countOfCorrectRadio_ByType", countOfCorrectRadio_ByType);
    add_result_to_form("countOfCorrectButton_ByType_Corrected", countOfCorrectButton_ByType_Corrected);
    add_result_to_form("percentageCorrectNumber_ByType", percentageCorrectNumber_ByType);
    add_result_to_form("percentageCorrectButton_ByType", percentageCorrectButton_ByType);
    add_result_to_form("percentageCorrectRadio_ByType", percentageCorrectRadio_ByType);
    add_result_to_form("meanNumber_ByType", meanNumber_ByType);
    add_result_to_form("sumNumber_ByType", sumNumber_ByType);
    add_result_to_form("meanRT_ByType", meanRT_ByType);
    add_result_to_form("meanDeviationNumber_ByType", meanDeviationNumber_ByType);
    add_result_to_form("sumWeightedRadio_ByType", sumWeightedRadio_ByType);
    add_result_to_form("type4_Unique", type4_Unique);
    add_result_to_form("timeset", timeset);
    add_result_to_form("buttonset", buttonset);
    add_result_to_form("numset", buttonset);
    ////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////

    mui.toast('练习结束!2秒后自动跳转正式任务页面!', {duration: 'long', type: 'div'})
    $('.formalResult').removeClass('active');
    setTimeout(function () {
        mui.openWindow({
            url: '../../../task_1/task_type.html?type=4&practice=true',
            createNew: true,
            styles: {
                cachemode: "noCache",
            }
        });
    }, 2000);

}

function show_user_result() {

    document.getElementById("up_span").style.display = "none";
    for (var i = 1; i <= 8; i++) {
        document.getElementById("" + i).style.display = "none";
    }

    document.getElementById("feed_back_div").style.display = "block";
    //alert(user_result[index]+"  "+correct_result[index]);
    if (user_result[index] == correct_result[index]) {
        /*答对*/
        document.getElementById("message").innerHTML = "选择正确！能否再快一些!";
        //document.getElementById('messageimageObj').src =pleased_image;
    } else {
        /*答错*/
        document.getElementById("message").innerHTML = "选择错误!";
        //document.getElementById('messageimageObj').src =depressed_image;
    }

    index++;
    setTimeout("show_fixation()", blank_interval);

}

function check_the_image(imageid) {
    //if(user_result[index]==undef_key)
    //{
    user_result[index] = imageid;
    //}
    show_user_result();


}

function show_status_bar() {
    //alert(jg);
    jg.setColor("#ffeeaa");
    jg.drawRect(20, 40, bar_length, 20);// x-pix y-pix width height
    jg.paint();

    jg.setColor("#00aaaa");
    jg.fillRect(20, 40, progressbar, 20);
    jg.paint();


    if (progressbar < bar_length) {
        setTimeout("show_status_bar()", update_interval);
    }
    progressbar++;

}

function start_progressbar() {
    jg.clear();
    progressbar = 0;
    setTimeout("show_status_bar()", 0);
}


function getTimestamp() {
    var now = new Date();
    return now.getTime(); // in ms
}

function start() {
    //document.getElementById('loading').style.display="none";
    start_time = getTimestamp();
    preloadimages();

}

function show_loading() {
    document.getElementById('imageObj').src = loading_image;
    setTimeout("start()", start_delay);
}

window.onload = show_loading

</script>


</html>
